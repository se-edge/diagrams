@startuml
legend top left
  On transitions : trigger [guard] /action
  ğŸ—² is a system telemetry
  â†» means we stay in this state
  On every state entrance a twin update is performed
endlegend
state fork_state <<fork>>
[*]        -down-> fork_state : twin update [new app] /ğŸ—²install in progress & compose create
[*]            --> [*]        : install failed (download failes / bad twind / bad compose / ...) [] /ğŸ—²install failed && clean artefacts
fork_state -down-> Starting   : [desired state == running] /compose start
fork_state -down-> Stopped    : [desired state == stopped]
fork_state -down-> Stopped    : [desired state == running && fail to start]
Starting                      : â†» While probe container health is starting && container state is running
Starting       --> Running    : [probe container health == healthy]
Starting       --> Unhealthy  : health check [desired state == running && probe container health == unhealthy]
Starting       --> Stopped    : twin update [desired state == stopped] /compose stop
Running                       : â†» While probe container health is healthty && container state is running
Running        --> Stopped    : twin update [desired state == stopped] /compose stop
Running        --> Stopped    : probe container crashed
Running        --> Unhealthy  : health check [probe container health == unhealthy]
Running        --> Removing   : twin update [app removed] /ğŸ—²uninstall in progress & compose down
Unhealthy                     : â†» While probe container health is unhealthy && container state is running
Unhealthy      --> Stopped    : twin update [desired state == stopped]
Unhealthy      --> Stopped    : probe container crashed
Unhealthy      --> Unhealthy  : health check [probe container health == unhealthy]
Unhealthy      --> Running    : health check [probe container health == healthy]
Unhealthy      --> Removing   : twin update [app removed] /ğŸ—²uninstall in progress & compose down
Stopped                       : â†» While prob container state is dead, exited, created
Stopped        --> Starting   : twin update [desired state == running] /compose start
Stopped        --> Restarting : probe container crashed [restart mode == always] /docker auto restart
Stopped        --> Removing   : twin update [app removed] /ğŸ—²uninstall in progress && compose down
Restarting                    : â†» While probe container state is restarting
Restarting     --> Stopped    : [state is stopped, dead, exited, created]
Restarting     --> Running    : [probe container health == healthy && state == running]
Removing       --> [*]
@enduml
